<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Portfolio">
  <meta name="author" content="Phillip Zhou">
  <title>Portfolio</title>

  <!-- Interceptor for the favicon.ico error. -->
  <intercept-url pattern="/favicon.ico" access="ROLE_ANONYMOUS" />

  <!-- Image for link icon. -->
  <link href="../img/favicon.png" rel="icon" />

  <!-- Bootstrap Core CSS -->
  <link href="../css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="../css/blog.css" rel="stylesheet">

  <!-- Custom Fonts -->
  <link href="../font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

  <!-- Navigation Sidebar -->
  <nav id="sidebar-container">
    <ul class="sidebar-nav">

      <!-- Toggle button for the sidebar. -->
      <a id="menu-toggle" href="#" class="btn btn-dark btn-lg pull-right menu-inactive">
        <i id="menu-icon" class="fa fa-toggle-right"></i>
      </a>

      <li class="sidebar-brand">
        <a href="#">Menu</a>
      </li>

      <!-- List of all menu items. -->
      <li>
        <a href="../index.html" class="disabled">Home</a>
      </li>
    </ul>
  </nav>
  <!-- End of Navigation Sidebar. -->

  <!-- Header section. -->
  <header id="top" data-stellar-background-ratio="0.5" class="header">
    <div class="header-text">
      <h1>Implementing Auto-Input in Android</h1>
      <h3>July 29, 2018 &bull; Posted by Phillip Zhou</h3>
    </div>
  </header>
  <!-- End of Header section. -->

  <!-- Blog contents section. -->
  <section class="blog-contents">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <p class="introduction">Let's use Android's Accessibility Services to create an app that sends tap inputs for the user! This can be used to help test other apps or help users avoid injuries that occur from repetitive actions.</p>

          <p>First, let's start off with a new Android project with an empty Activity. Note that the minimum SDK that the project must target is 24 for gesture inputs to work. I'll be using Kotlin for this tutorial, but the concepts that are used should
            be able to be translated to Java without too much difficulty. However, as I don't fully understand how Accessibility Services work, I'll be adding comments to some of the code snippets that I post here - they're not necessary to make the app
            work though.</p>

          <p>After the project has been created, let's create a new class that extends from the AccessibilityService class. For this tutorial, I've named the file <code>InputTapService.kt</code>. Implement the methods that AccessibilityService requires,
            but don't fill anything in yet. The file should look like the following:</p>

          <pre>
  package com.example.pzhou.inputtutorial

  import android.accessibilityservice.AccessibilityService
  import android.view.accessibility.AccessibilityEvent

  class InputTapService : AccessibilityService()
  {
      <code class="comments">/**
       * This method is called when the system wants to interrupt the feedback the
       * Accessibility Service is providing. Typically, this method will be called
       * in response to a user action, like moving focus to a different control.
       */</code>
      override fun onInterrupt()
      {
          TODO("not implemented")
      }

      <code class="comments">/**
       * This method is called by the system when it detects an event that matches
       * the event(s) specified by the Accessibility Service. For example, if this
       * Accessibility Service specifies that button clicks are to be captured, any
       * button click events that occur will cause the system to call this method.
       *
       * @param accessibilityEvent The event that occurred.
       */</code>
      override fun onAccessibilityEvent(accessibilityEvent: AccessibilityEvent?)
      {
          TODO("not implemented")
      }
  }
          </pre>

          <p>Then, because this is a Service, we need to add it to the <code>AndroidManifest.xml</code> file. In addition, we'll also need to ask for permission and add an intent filter for the system to bind to the Accessibility Service.</p>

          <p class="sidenote">As a sidenote, I did some testing, and it seems that Accessibility Services run on the same thread as the app by default. For this reason, sending too many commands to the service leads to an Application Not Responding error. However, oddly
            enough, while they were on the same thread, killing the app does not actually kill the Accessibility Service. </p>
          <p>Just to be safe though, we'll put the service on a different process. </p>

          <pre>
  &lt;activity android:name=".MainActivity"&gt;
    <code class="comments">Activity content here...</code>
  &lt;/activity&gt;

  &lt;service
    android:name=".InputTapService"
    android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE"
    android:process=":inputprocess"&gt;

      &lt;intent-filter&gt;
        &lt;action android:name="android.accessibilityservice.AccessibilityService"/&gt;
      &lt;/intent-filter&gt;

  &lt;/service&gt;

  <code class="comments">Rest of &lt;application&gt; contents here...</code>
          </pre>

          <p>After the service has been added to the Android Manifest file, we'll need to configure the Accessibility Service. Configuration of the service can be done either via an XML file or programatically within <code>onServiceConnected()</code>. However,
            to enable the service to dispatch gestures to the device, the XML configuration method is required.
          </p>

          <p>To do this, we'll first create an <code>xml</code> folder inside of the res directory. Then, inside of the <code>xml</code> folder, create an .xml file called <code>serviceconfig.xml</code>, and delete all of its contents. After that, add the
            following code to the file (some of the elements are optional, and have been marked as such):
          </p>

          <pre>
  &lt;?xml version="1.0" encoding="utf-8"?&gt;

  <code class="comments">&lt;!-- Explanation of tags:

      android:accessibilityEventTypes - Lists the events that this service will listen
          for. Since the service will be inputting gestures and not listening for any
          events, it's fine to leave this blank. The typeAllMask will cause the service
          to listen to all events. (OPTIONAL)

      android:accessibilityFeedbackType - Feedback types that the service provides.
          It's fine to set it to feedbackVisual for now. (REQUIRED)

      android:accessibilityFlags - Set it to flagDefault. (REQUIRED)

      android:canPerformGestures - Requires SDK 24+. This allows the service to send
          gestures for the user. Set this to true. (REQUIRED)

      android:packageNames - List of apps that the service will listen to and interact
          with. If this field is empty, then the service will listen to and interact
          with all applications. (OPTIONAL)
  --&gt;</code>
  &lt;accessibility-service xmlns:android="http://schemas.android.com/apk/res/android"
      android:accessibilityEventTypes=""
      android:accessibilityFeedbackType="feedbackVisual"
      android:accessibilityFlags="flagDefault"
      android:canPerformGestures="true"
      android:notificationTimeout="100"
      android:packageNames=""
  /&gt;
          </pre>

          <p>Once the configuration file has been created, we'll need to set the file as the configuration for our service. Go back to the Android Manifest file, and add a meta-data element inside of the service element so that it looks like this:
          </p>

          <pre>
  &lt;service
      android:name=".InputTapService"
      android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE"
      android:process=":inputprocess"&gt;

      &lt;intent-filter&gt;
          &lt;action android:name="android.accessibilityservice.AccessibilityService" /&gt;
      &lt;/intent-filter&gt;

      <code class="comments">&lt;!-- Required to set the configuration of the service. --&gt;</code>
      &lt;meta-data
          android:name="android.accessibilityservice"
          android:resource="@xml/serviceconfig" /&gt;
  &lt;/service&gt;
          </pre>
        </div>
      </div>
    </div>
  </section>
  <!-- End of Blog contents section. -->

  <!-- Contact section. -->
  <footer id="contact" data-stellar-background-ratio="0.25" class="contact bg-primary">
    <div class="container">

      <!-- Contacts title. -->
      <div class="row mb-5">
        <h1>Contact Info</h1>
      </div>

      <!-- Icon and info row. -->
      <div class="row mb-5">
        <!-- Icons column. -->
        <div id="icons" class="col-md-4">
          <ul class="list-unstyled">
            <li><i class="fa fa-phone fa-2x"></i></li>
            <li><i class="fa fa-envelope-o fa-2x"></i></li>
            <li><i class="fa fa-linkedin-square fa-2x"></i></li>
          </ul>
        </div>

        <!-- Info column. -->
        <div id="info" class="col-md-4">
          <ul class="list-unstyled">
            <li>
              <h3>(925) 719-9407</h3></li>
            <li>
              <h3><a id="email" href="mailto:pzhou53@gmail.com">pzhou53@gmail.com</a></h3>
            </li>
            <li>
              <h3><a id="linked-in" href="https://www.linkedin.com/in/phzhou">linkedin.com/in/phzhou</a></h3>
            </li>
          </ul>
        </div>

      </div>

    </div>
  </footer>
  <!-- End of Contact section. -->

  <!-- jQuery. -->
  <script src="../js/jquery.js" type="text/javascript"></script>

  <!-- Bootstrap Core JavaScript. -->
  <script src="../js/bootstrap.min.js" type="text/javascript"></script>

  <!-- Stellar JavaScript. -->
  <script src="../js/jquery.stellar.min.js" type="text/javascript"></script>

  <!-- Javascript functions for the Portfolio. -->
  <script src="../js/blog.js" type="text/javascript"></script>

</body>

</html>
